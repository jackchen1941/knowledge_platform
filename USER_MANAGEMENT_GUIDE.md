# 👥 用户管理指南 / User Management Guide

> 管理员完整的用户管理功能指南

## 📋 目录 / Table of Contents

- [功能概述](#功能概述)
- [访问用户管理](#访问用户管理)
- [用户列表](#用户列表)
- [创建用户](#创建用户)
- [编辑用户](#编辑用户)
- [删除用户](#删除用户)
- [用户权限](#用户权限)
- [批量操作](#批量操作)

---

## 🎯 功能概述 / Feature Overview

用户管理功能允许管理员：

- ✅ 查看所有用户列表
- ✅ 创建新用户
- ✅ 编辑用户信息
- ✅ 删除用户
- ✅ 启用/禁用用户
- ✅ 设置管理员权限
- ✅ 查看用户统计
- ✅ 搜索和过滤用户

**权限要求**: 仅超级管理员可以访问用户管理功能

---

## 🚪 访问用户管理 / Access User Management

### 方式一：通过导航菜单

1. 使用管理员账户登录
2. 点击左侧菜单的 **"用户管理"**
3. 进入用户管理页面

### 方式二：直接访问

访问: http://localhost:3000/users

### 验证权限

如果您看到 "403 Forbidden" 或无法访问，说明：
- 您不是超级管理员
- 需要联系现有管理员授予权限

---

## 📊 用户列表 / User List

### 页面布局

```
┌─────────────────────────────────────────────────────┐
│  用户管理                          [+ 新建用户]      │
├─────────────────────────────────────────────────────┤
│  统计卡片:                                          │
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐              │
│  │总用户│ │活跃  │ │已验证│ │管理员│              │
│  └──────┘ └──────┘ └──────┘ └──────┘              │
├─────────────────────────────────────────────────────┤
│  用户表格:                                          │
│  用户名 | 邮箱 | 姓名 | 状态 | 验证 | 角色 | 操作  │
│  ─────────────────────────────────────────────────  │
│  admin  | admin@... | 管理员 | 活跃 | 已验证 | ... │
│  user1  | user1@... | 用户1  | 活跃 | 未验证 | ... │
└─────────────────────────────────────────────────────┘
```

### 用户信息列

| 列名 | 说明 | 示例 |
|------|------|------|
| 用户名 | 登录用户名 | admin, user1 |
| 邮箱 | 用户邮箱地址 | admin@example.com |
| 姓名 | 用户真实姓名 | 张三, John Doe |
| 状态 | 活跃/禁用 | 🟢 活跃 / ⚫ 禁用 |
| 验证 | 邮箱验证状态 | ✅ 已验证 / ⏳ 未验证 |
| 角色 | 用户角色 | 🔷 管理员 / 👤 普通用户 |
| 创建时间 | 账户创建日期 | 2026-02-10 |
| 操作 | 编辑/删除按钮 | [编辑] [删除] |

### 用户统计

页面顶部显示四个统计卡片：

1. **总用户数** - 系统中所有用户的数量
2. **活跃用户** - 状态为"活跃"的用户数量
3. **已验证用户** - 已完成邮箱验证的用户数量
4. **管理员** - 拥有管理员权限的用户数量

### 搜索和过滤

```
搜索框: [输入用户名、邮箱或姓名搜索...]

过滤器:
- 状态: [全部 | 活跃 | 禁用]
- 角色: [全部 | 管理员 | 普通用户]
- 验证: [全部 | 已验证 | 未验证]
```

### 分页

- 每页显示: 20条（可调整为 10/20/50/100）
- 快速跳转: 输入页码直接跳转
- 总数显示: "共 X 条"

---

## ➕ 创建用户 / Create User

### 步骤

1. 点击右上角 **"+ 新建用户"** 按钮
2. 填写用户信息表单
3. 设置用户权限
4. 点击 **"保存"** 创建用户

### 表单字段

#### 必填字段

| 字段 | 说明 | 验证规则 | 示例 |
|------|------|---------|------|
| 用户名 | 登录用户名 | 3-20字符，字母数字下划线 | john_doe |
| 邮箱 | 用户邮箱 | 有效的邮箱格式 | john@example.com |
| 密码 | 登录密码 | 至少6个字符 | password123 |

#### 可选字段

| 字段 | 说明 | 默认值 |
|------|------|--------|
| 姓名 | 用户真实姓名 | 空 |
| 活跃状态 | 是否可以登录 | 开启 |
| 验证状态 | 邮箱是否已验证 | 关闭 |
| 管理员 | 是否为管理员 | 关闭 |

### 示例：创建普通用户

```
用户名: zhangsan
邮箱: zhangsan@example.com
姓名: 张三
密码: zhangsan123

权限设置:
☑ 活跃状态: 开启
☐ 验证状态: 关闭
☐ 管理员: 关闭
```

### 示例：创建管理员

```
用户名: admin2
邮箱: admin2@example.com
姓名: 副管理员
密码: admin2password

权限设置:
☑ 活跃状态: 开启
☑ 验证状态: 开启
☑ 管理员: 开启
```

### 注意事项

⚠️ **重要提示**:
- 用户名和邮箱必须唯一
- 密码至少6个字符，建议使用强密码
- 管理员权限谨慎授予
- 创建后会立即生效

---

## ✏️ 编辑用户 / Edit User

### 步骤

1. 在用户列表中找到要编辑的用户
2. 点击该用户行的 **"编辑"** 按钮
3. 修改用户信息
4. 点击 **"保存"** 更新用户

### 可编辑字段

| 字段 | 是否可修改 | 说明 |
|------|-----------|------|
| 用户名 | ✅ 是 | 修改后需要用新用户名登录 |
| 邮箱 | ✅ 是 | 修改后需要用新邮箱登录 |
| 姓名 | ✅ 是 | 可随时修改 |
| 密码 | ✅ 是 | 留空则不修改 |
| 活跃状态 | ✅ 是 | 禁用后无法登录 |
| 验证状态 | ✅ 是 | 可手动设置为已验证 |
| 管理员 | ✅ 是 | 可授予或撤销管理员权限 |

### 常见操作

#### 重置用户密码

1. 编辑用户
2. 在密码字段输入新密码
3. 保存

```
密码: [输入新密码]
确认密码: [再次输入新密码]
```

#### 禁用用户

1. 编辑用户
2. 将"活跃状态"切换为关闭
3. 保存

**效果**: 用户无法登录，但数据保留

#### 启用用户

1. 编辑被禁用的用户
2. 将"活跃状态"切换为开启
3. 保存

**效果**: 用户可以正常登录

#### 授予管理员权限

1. 编辑用户
2. 将"管理员"切换为开启
3. 保存

**效果**: 用户获得所有管理员权限

#### 撤销管理员权限

1. 编辑管理员用户
2. 将"管理员"切换为关闭
3. 保存

**效果**: 用户变为普通用户

### 注意事项

⚠️ **重要提示**:
- 不能编辑自己的管理员权限
- 修改邮箱或用户名后，用户需要用新信息登录
- 禁用用户不会删除其创建的内容
- 撤销管理员权限前请确认

---

## 🗑️ 删除用户 / Delete User

### 步骤

1. 在用户列表中找到要删除的用户
2. 点击该用户行的 **"删除"** 按钮
3. 在确认对话框中点击 **"确定"**

### 确认对话框

```
┌─────────────────────────────────┐
│  确定要删除吗？                  │
│                                 │
│  删除用户将无法恢复              │
│                                 │
│  [取消]  [确定]                 │
└─────────────────────────────────┘
```

### 删除限制

❌ **不能删除**:
- 自己的账户
- 系统默认管理员（如果配置了保护）

✅ **可以删除**:
- 其他普通用户
- 其他管理员（如果您是超级管理员）

### 删除影响

删除用户后：

| 数据类型 | 处理方式 |
|---------|---------|
| 用户账户 | 永久删除 |
| 用户创建的知识 | 保留（作者显示为"已删除用户"） |
| 用户的评论 | 保留（作者显示为"已删除用户"） |
| 用户的收藏 | 删除 |
| 用户的设置 | 删除 |

### 注意事项

⚠️ **重要提示**:
- 删除操作不可恢复
- 建议先禁用用户，确认无问题后再删除
- 删除前可以导出用户数据
- 用户创建的内容会保留

---

## 🔐 用户权限 / User Permissions

### 权限级别

系统有两个权限级别：

#### 1. 普通用户

**可以做**:
- ✅ 登录系统
- ✅ 创建、编辑、删除自己的知识
- ✅ 查看公开的知识
- ✅ 使用搜索功能
- ✅ 管理自己的分类和标签
- ✅ 导入和导出自己的数据
- ✅ 修改自己的个人信息

**不能做**:
- ❌ 查看其他用户的私有知识
- ❌ 编辑或删除其他用户的内容
- ❌ 访问用户管理
- ❌ 访问系统设置
- ❌ 查看系统统计

#### 2. 管理员（超级用户）

**额外权限**:
- ✅ 查看所有用户的内容
- ✅ 编辑或删除任何内容
- ✅ 访问用户管理
- ✅ 创建、编辑、删除用户
- ✅ 授予或撤销管理员权限
- ✅ 访问系统设置
- ✅ 查看系统统计和日志
- ✅ 管理全局分类和标签
- ✅ 执行系统备份和恢复

### 权限检查

系统在以下情况检查权限：

1. **登录时** - 检查用户是否活跃
2. **访问页面时** - 检查是否有访问权限
3. **执行操作时** - 检查是否有操作权限
4. **API调用时** - 检查JWT token和权限

### 权限最佳实践

1. **最小权限原则** - 只授予必要的权限
2. **定期审查** - 定期检查用户权限
3. **及时撤销** - 员工离职时及时删除或禁用账户
4. **管理员分离** - 不要所有人都是管理员
5. **审计日志** - 定期查看管理员操作日志

---

## 📦 批量操作 / Batch Operations

### 批量启用/禁用

```bash
# 使用API批量操作
curl -X POST http://localhost:8000/api/v1/users/batch/disable \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"user_ids": ["user1-id", "user2-id"]}'
```

### 批量删除

```bash
# 使用API批量删除
curl -X POST http://localhost:8000/api/v1/users/batch/delete \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"user_ids": ["user1-id", "user2-id"]}'
```

### 导出用户列表

```bash
# 导出为CSV
curl -X GET "http://localhost:8000/api/v1/users/export?format=csv" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -o users.csv

# 导出为JSON
curl -X GET "http://localhost:8000/api/v1/users/export?format=json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -o users.json
```

---

## 📊 用户统计 / User Statistics

### 查看统计

访问: http://localhost:3000/users

统计信息包括：

1. **总用户数** - 所有注册用户
2. **活跃用户** - 可以登录的用户
3. **禁用用户** - 被禁用的用户
4. **已验证用户** - 完成邮箱验证的用户
5. **未验证用户** - 未完成邮箱验证的用户
6. **管理员数量** - 拥有管理员权限的用户
7. **普通用户数量** - 没有管理员权限的用户

### 用户活动统计

```bash
# 查看用户活动
curl -X GET "http://localhost:8000/api/v1/users/stats/activity" \
  -H "Authorization: Bearer YOUR_TOKEN"

# 返回示例:
{
  "total_users": 10,
  "active_today": 5,
  "active_this_week": 8,
  "active_this_month": 10,
  "new_users_this_month": 2
}
```

---

## 🔍 搜索用户 / Search Users

### 搜索功能

在用户列表页面的搜索框中输入：

- **用户名** - 搜索用户名
- **邮箱** - 搜索邮箱地址
- **姓名** - 搜索真实姓名

### 搜索示例

```
搜索: "admin"
结果: 
- admin@example.com (用户名: admin)
- admin2@example.com (用户名: admin2)
- user@example.com (姓名: Admin User)
```

### 高级过滤

组合使用搜索和过滤器：

```
搜索: "zhang"
过滤:
- 状态: 活跃
- 角色: 普通用户
- 验证: 已验证

结果: 所有用户名、邮箱或姓名包含"zhang"的活跃、已验证的普通用户
```

---

## 🛡️ 安全建议 / Security Recommendations

### 密码策略

1. **强密码要求**
   - 至少8个字符
   - 包含大小写字母
   - 包含数字
   - 包含特殊字符

2. **定期更换**
   - 建议每3-6个月更换密码
   - 发现异常立即更换

3. **不要共享**
   - 每个用户使用独立账户
   - 不要共享管理员账户

### 账户安全

1. **及时禁用**
   - 员工离职立即禁用账户
   - 长期不用的账户定期清理

2. **权限审查**
   - 每月审查管理员列表
   - 撤销不必要的权限

3. **监控异常**
   - 关注异常登录
   - 查看审计日志

### 数据保护

1. **定期备份**
   - 每天备份用户数据
   - 保留多个备份版本

2. **隐私保护**
   - 不要泄露用户信息
   - 遵守数据保护法规

---

## 📝 常见问题 / FAQ

### Q1: 如何重置用户密码？

**A**: 编辑用户 → 输入新密码 → 保存

### Q2: 删除用户后能恢复吗？

**A**: 不能。删除是永久性的，建议先禁用用户。

### Q3: 如何批量创建用户？

**A**: 使用API批量导入，或编写脚本调用创建用户API。

### Q4: 普通用户能看到其他用户吗？

**A**: 不能。只有管理员可以查看用户列表。

### Q5: 如何导出用户列表？

**A**: 使用导出API或在用户管理页面点击导出按钮。

### Q6: 能限制用户创建的知识数量吗？

**A**: 当前版本不支持，可以通过自定义开发实现。

### Q7: 如何设置用户配额？

**A**: 当前版本不支持配额功能，计划在未来版本添加。

### Q8: 能批量导入用户吗？

**A**: 可以通过API批量导入，需要准备JSON或CSV格式的用户数据。

---

## 🔗 相关文档 / Related Documentation

- [全新部署指南](FRESH_DEPLOYMENT_GUIDE.md)
- [故障排查指南](TROUBLESHOOTING.md)
- [API文档](http://localhost:8000/docs)
- [安全指南](REPOSITORY_SECURITY_GUIDE.md)

---

**💡 提示**: 用户管理是系统的核心功能，请谨慎操作，定期备份数据。

---

*最后更新: 2026-02-10*
*版本: v1.1.0*
